aggregate_pm_census_cdc_test_beds$face_masks <- ifelse(aggregate_pm_census_cdc_test_beds$Face_Masks_Required_in_Public == "Yes", 1, 
               ifelse(aggregate_pm_census_cdc_test_beds$Face_Masks_Required_in_Public == "No", 2, 0))

#Estimate propensity score
fitps <- glm(Deaths ~ face_masks + X..Tests.per.100K
             + perc_unins, data=aggregate_pm_census_cdc_test_beds)
summary(fitps)
aggregate_pm_census_cdc_test_beds$ps <- predict(fitps, aggregate_pm_census_cdc_test_beds, type="response")

summary(aggregate_pm_census_cdc_test_beds$ps[aggregate_pm_census_cdc_test_beds$Deaths==0])
summary(aggregate_pm_census_cdc_test_beds$ps[aggregate_pm_census_cdc_test_beds$Deaths==1])

fit<-glm(data=aggregate_pm_census_cdc_test_beds, mean_pm25 ~ Deaths + ps)
summary(fit)
cbind(coef(fit),confint(fit))
